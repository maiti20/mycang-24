import{d as X,r as m,j as F,c as Y,k as Z,a as b,h as A,b as t,l as tt,f as V,t as i,w as p,v as x,i as I,e as f,F as U,g as j,n as h,m as D,q as st,p as T,o as c,_ as et}from"./index-CQKIO0cK.js";import{Q as lt}from"./QuickAddExerciseModal-DjFazEQS.js";const ot={class:"exercise-log-view container py-4"},at={class:"row mb-4"},it={class:"col-md-6 col-lg-3 mb-3"},nt={class:"card h-100 border-0 shadow-sm hover-lift"},dt={class:"card-body text-center"},rt={class:"fw-bold text-success"},ct={class:"col-md-6 col-lg-3 mb-3"},ut={class:"card h-100 border-0 shadow-sm hover-lift"},bt={class:"card-body text-center"},vt={class:"fw-bold text-warning"},mt={class:"col-md-6 col-lg-3 mb-3"},pt={class:"card h-100 border-0 shadow-sm hover-lift"},ft={class:"card-body text-center"},gt={class:"fw-bold text-info"},yt={class:"row mb-4"},xt={class:"col-12"},ht={class:"card border-0 shadow-sm"},wt={class:"card-body"},_t={class:"row g-3 align-items-end"},kt={class:"col-md-3"},Ct={class:"input-group"},Dt={class:"col-md-2"},Lt={class:"col-md-2"},St={class:"col-md-2"},Mt={class:"row"},Vt={class:"col-12"},Tt={class:"card border-0 shadow-sm"},Et={class:"card-header bg-white border-bottom"},Ft={class:"d-flex justify-content-between align-items-center"},At={class:"badge bg-primary rounded-pill"},It={class:"card-body p-0"},Ut={key:0,class:"text-center py-5"},jt={key:1,class:"table-responsive"},Nt={class:"table table-hover mb-0"},Bt={class:"d-flex align-items-center"},Qt={class:"fw-semibold"},$t={class:"text-muted"},zt={class:"badge bg-light text-dark"},Ht={class:"fw-semibold"},qt={class:"fw-semibold text-danger"},Pt={class:"text-muted"},Wt={class:"text-truncate",style:{"max-width":"150px"}},Gt={class:"btn-group btn-group-sm"},Jt=["onClick"],Kt=["onClick"],Ot={key:2,class:"text-center py-5"},Rt={key:0,class:"card-footer bg-white border-top"},Xt={"aria-label":"运动记录分页"},Yt={class:"pagination pagination-sm justify-content-center mb-0"},Zt=["onClick"],ts={class:"modal-dialog modal-dialog-centered"},ss={class:"modal-content"},es={class:"modal-body"},ls={class:"mb-3"},os=["value"],as={class:"row"},is={class:"col-md-6 mb-3"},ns={class:"col-md-6 mb-3"},ds={class:"mb-3"},rs={class:"d-flex justify-content-end gap-2"},cs=["disabled"],us={key:0,class:"spinner-border spinner-border-sm me-1"},bs=X({__name:"ExerciseLogView",setup(vs){const L=m(!1),w=m(!1),g=m([]),a=m({page:1,limit:10,total:0,pages:0}),_=m({totalDuration:0,totalCalories:0,totalSessions:0}),k=m(!1),C=m(!1),y=m(null),o=F({search:"",category:"",dateFrom:"",dateTo:""}),u=F({duration_minutes:0,intensity_level:"中等",notes:""}),N=Y(()=>{const l=a.value.page,s=a.value.pages,d=2,r=[],e=[];for(let v=Math.max(2,l-d);v<=Math.min(s-1,l+d);v++)r.push(v);return l-d>2?e.push(1,"..."):e.push(1),e.push(...r),l+d<s-1?e.push("...",s):e.push(s),e.filter((v,O,R)=>v!=="..."||R[O-1]!=="...")}),n=async()=>{L.value=!0;try{const l={page:a.value.page,limit:a.value.limit};o.search&&(l.search=o.search),o.category&&(l.category=o.category),o.dateFrom&&(l.date_from=o.dateFrom),o.dateTo&&(l.date_to=o.dateTo);const s=await T.getExerciseLogs(l);s.success&&(g.value=s.data.logs,a.value=s.data.pagination,B())}catch(l){console.error("获取运动记录失败:",l)}finally{L.value=!1}},B=()=>{const l=new Date,s=new Date(l.setDate(l.getDate()-l.getDay()));s.setHours(0,0,0,0);const d=g.value.filter(r=>new Date(r.log_date)>=s);_.value={totalDuration:d.reduce((r,e)=>r+e.duration_minutes,0),totalCalories:Math.round(d.reduce((r,e)=>r+e.calories_burned,0)),totalSessions:d.length}},S=l=>{l>=1&&l<=a.value.pages&&(a.value.page=l,n())},Q=()=>{a.value.page=1,n()},$=()=>{o.search="",o.category="",o.dateFrom="",o.dateTo="",a.value.page=1,n()},E=()=>{k.value=!0},z=()=>{k.value=!1},H=()=>{n()},q=l=>{y.value=l,u.duration_minutes=l.duration_minutes,u.intensity_level=l.intensity_level,u.notes=l.notes,C.value=!0},M=()=>{C.value=!1,y.value=null},P=async()=>{if(y.value){w.value=!0;try{(await T.updateExerciseLog(y.value.id,u)).success&&(n(),M())}catch(l){console.error("更新运动记录失败:",l)}finally{w.value=!1}}},W=async l=>{if(confirm("确定要删除这条运动记录吗？"))try{(await T.deleteExerciseLog(l)).success&&n()}catch(s){console.error("删除运动记录失败:",s)}},G=l=>{switch(l){case"低":return"bg-success";case"中等":return"bg-warning";case"高":return"bg-danger";default:return"bg-secondary"}},J=l=>new Date(l).toLocaleDateString("zh-CN"),K=l=>new Date(l).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});return Z(()=>{n()}),(l,s)=>{var d,r;return c(),b("div",ot,[s[49]||(s[49]=A('<div class="row mb-4" data-v-73fe4b1b><div class="col-12" data-v-73fe4b1b><div class="card border-0 bg-gradient-primary text-white" data-v-73fe4b1b><div class="card-body" data-v-73fe4b1b><h1 class="mb-2" data-v-73fe4b1b><i class="bi bi-activity me-2" data-v-73fe4b1b></i> 运动记录日志 </h1><p class="mb-0 opacity-75" data-v-73fe4b1b>查看和管理您的运动记录，追踪健身进度</p></div></div></div></div>',1)),t("div",at,[t("div",{class:"col-md-6 col-lg-3 mb-3"},[t("div",{class:"card h-100 border-0 shadow-sm hover-lift"},[t("div",{class:"card-body text-center"},[s[9]||(s[9]=t("div",{class:"text-primary mb-3"},[t("i",{class:"bi bi-plus-circle fs-1"})],-1)),s[10]||(s[10]=t("h5",{class:"card-title"},"快速记录",-1)),s[11]||(s[11]=t("p",{class:"card-text text-muted small"},"立即记录今天的运动",-1)),t("button",{class:"btn btn-primary btn-sm",onClick:E}," 开始记录 ")])])]),t("div",it,[t("div",nt,[t("div",dt,[s[12]||(s[12]=t("div",{class:"text-success mb-3"},[t("i",{class:"bi bi-calendar-week fs-1"})],-1)),s[13]||(s[13]=t("h5",{class:"card-title"},"本周统计",-1)),s[14]||(s[14]=t("p",{class:"card-text text-muted small"},"查看本周运动数据",-1)),t("div",rt,i(_.value.totalDuration)+" 分钟",1)])])]),t("div",ct,[t("div",ut,[t("div",bt,[s[15]||(s[15]=t("div",{class:"text-warning mb-3"},[t("i",{class:"bi bi-fire fs-1"})],-1)),s[16]||(s[16]=t("h5",{class:"card-title"},"消耗卡路里",-1)),s[17]||(s[17]=t("p",{class:"card-text text-muted small"},"本周总消耗",-1)),t("div",vt,i(_.value.totalCalories)+" 千卡",1)])])]),t("div",mt,[t("div",pt,[t("div",ft,[s[18]||(s[18]=t("div",{class:"text-info mb-3"},[t("i",{class:"bi bi-trophy fs-1"})],-1)),s[19]||(s[19]=t("h5",{class:"card-title"},"运动次数",-1)),s[20]||(s[20]=t("p",{class:"card-text text-muted small"},"本周运动次数",-1)),t("div",gt,i(_.value.totalSessions)+" 次",1)])])])]),t("div",yt,[t("div",xt,[t("div",ht,[t("div",wt,[t("div",_t,[t("div",kt,[s[22]||(s[22]=t("label",{class:"form-label fw-semibold"},"搜索运动",-1)),t("div",Ct,[s[21]||(s[21]=t("span",{class:"input-group-text"},[t("i",{class:"bi bi-search"})],-1)),p(t("input",{type:"text",class:"form-control",placeholder:"输入运动名称...","onUpdate:modelValue":s[0]||(s[0]=e=>o.search=e),onInput:Q},null,544),[[x,o.search]])])]),t("div",Dt,[s[24]||(s[24]=t("label",{class:"form-label fw-semibold"},"运动类型",-1)),p(t("select",{class:"form-select","onUpdate:modelValue":s[1]||(s[1]=e=>o.category=e),onChange:n},[...s[23]||(s[23]=[A('<option value="" data-v-73fe4b1b>全部类型</option><option value="有氧运动" data-v-73fe4b1b>有氧运动</option><option value="力量训练" data-v-73fe4b1b>力量训练</option><option value="HIIT" data-v-73fe4b1b>HIIT</option><option value="拉伸放松" data-v-73fe4b1b>拉伸放松</option>',5)])],544),[[I,o.category]])]),t("div",Lt,[s[25]||(s[25]=t("label",{class:"form-label fw-semibold"},"开始日期",-1)),p(t("input",{type:"date",class:"form-control","onUpdate:modelValue":s[2]||(s[2]=e=>o.dateFrom=e),onChange:n},null,544),[[x,o.dateFrom]])]),t("div",St,[s[26]||(s[26]=t("label",{class:"form-label fw-semibold"},"结束日期",-1)),p(t("input",{type:"date",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=e=>o.dateTo=e),onChange:n},null,544),[[x,o.dateTo]])]),t("div",{class:"col-md-3"},[t("div",{class:"d-flex gap-2"},[t("button",{class:"btn btn-outline-secondary flex-fill",onClick:$},[...s[27]||(s[27]=[t("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),f(" 重置 ",-1)])]),t("button",{class:"btn btn-primary flex-fill",onClick:n},[...s[28]||(s[28]=[t("i",{class:"bi bi-funnel me-1"},null,-1),f(" 筛选 ",-1)])])])])])])])])]),t("div",Mt,[t("div",Vt,[t("div",Tt,[t("div",Et,[t("div",Ft,[s[29]||(s[29]=t("h5",{class:"mb-0 fw-semibold"},[t("i",{class:"bi bi-list-ul me-2"}),f(" 运动记录列表 ")],-1)),t("span",At,i(a.value.total)+" 条记录 ",1)])]),t("div",It,[L.value?(c(),b("div",Ut,[...s[30]||(s[30]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"加载中...")],-1),t("p",{class:"mt-2 text-muted"},"正在加载运动记录...",-1)])])):g.value.length>0?(c(),b("div",jt,[t("table",Nt,[s[35]||(s[35]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"运动名称"),t("th",null,"类型"),t("th",null,"时长"),t("th",null,"强度"),t("th",null,"消耗卡路里"),t("th",null,"记录时间"),t("th",null,"备注"),t("th",{width:"120"},"操作")])],-1)),t("tbody",null,[(c(!0),b(U,null,j(g.value,e=>(c(),b("tr",{key:e.id},[t("td",null,[t("div",Bt,[s[31]||(s[31]=t("div",{class:"avatar avatar-sm bg-primary bg-opacity-10 text-primary rounded-circle me-2 d-flex align-items-center justify-content-center"},[t("i",{class:"bi bi-activity"})],-1)),t("div",null,[t("div",Qt,i(e.exercise.name),1),t("small",$t,i(e.exercise.muscle_groups.join(", ")),1)])])]),t("td",null,[t("span",zt,i(e.exercise.category),1)]),t("td",null,[t("div",Ht,i(e.duration_minutes)+" 分钟",1)]),t("td",null,[t("span",{class:h(["badge",G(e.intensity_level)])},i(e.intensity_level),3)]),t("td",null,[t("div",qt,[s[32]||(s[32]=t("i",{class:"bi bi-fire"},null,-1)),f(" "+i(Math.round(e.calories_burned))+" 千卡 ",1)])]),t("td",null,[t("div",null,i(J(e.log_date)),1),t("small",Pt,i(K(e.log_date)),1)]),t("td",null,[t("div",Wt,i(e.notes||"-"),1)]),t("td",null,[t("div",Gt,[t("button",{class:"btn btn-outline-primary",onClick:v=>q(e),title:"编辑"},[...s[33]||(s[33]=[t("i",{class:"bi bi-pencil"},null,-1)])],8,Jt),t("button",{class:"btn btn-outline-danger",onClick:v=>W(e.id),title:"删除"},[...s[34]||(s[34]=[t("i",{class:"bi bi-trash"},null,-1)])],8,Kt)])])]))),128))])])])):(c(),b("div",Ot,[s[37]||(s[37]=t("div",{class:"text-muted mb-3"},[t("i",{class:"bi bi-inbox fs-1"})],-1)),s[38]||(s[38]=t("h5",{class:"text-muted"},"暂无运动记录",-1)),s[39]||(s[39]=t("p",{class:"text-muted"},"开始记录您的第一次运动吧！",-1)),t("button",{class:"btn btn-primary",onClick:E},[...s[36]||(s[36]=[t("i",{class:"bi bi-plus-circle me-2"},null,-1),f(" 添加运动记录 ",-1)])])]))]),g.value.length>0?(c(),b("div",Rt,[t("nav",Xt,[t("ul",Yt,[t("li",{class:h(["page-item",{disabled:a.value.page<=1}])},[t("a",{class:"page-link",href:"#",onClick:s[4]||(s[4]=D(e=>S(a.value.page-1),["prevent"]))},[...s[40]||(s[40]=[t("i",{class:"bi bi-chevron-left"},null,-1)])])],2),(c(!0),b(U,null,j(N.value,e=>(c(),b("li",{key:e,class:h(["page-item",{active:e===a.value.page}])},[t("a",{class:"page-link",href:"#",onClick:D(v=>S(e),["prevent"])},i(e),9,Zt)],2))),128)),t("li",{class:h(["page-item",{disabled:a.value.page>=a.value.pages}])},[t("a",{class:"page-link",href:"#",onClick:s[5]||(s[5]=D(e=>S(a.value.page+1),["prevent"]))},[...s[41]||(s[41]=[t("i",{class:"bi bi-chevron-right"},null,-1)])])],2)])])])):V("",!0)])])]),k.value?(c(),tt(lt,{key:0,show:k.value,onClose:z,onAdded:H},null,8,["show"])):V("",!0),t("div",{class:h(["modal fade",{show:C.value}]),style:st({display:C.value?"block":"none"}),tabindex:"-1"},[t("div",ts,[t("div",ss,[t("div",{class:"modal-header"},[s[42]||(s[42]=t("h5",{class:"modal-title"},"编辑运动记录",-1)),t("button",{type:"button",class:"btn-close",onClick:M})]),t("div",es,[t("form",{onSubmit:D(P,["prevent"])},[t("div",ls,[s[43]||(s[43]=t("label",{class:"form-label"},"运动名称",-1)),t("input",{type:"text",class:"form-control",value:(r=(d=y.value)==null?void 0:d.exercise)==null?void 0:r.name,readonly:""},null,8,os)]),t("div",as,[t("div",is,[s[44]||(s[44]=t("label",{class:"form-label"},"运动时长（分钟）",-1)),p(t("input",{type:"number",class:"form-control","onUpdate:modelValue":s[6]||(s[6]=e=>u.duration_minutes=e),min:"1",required:""},null,512),[[x,u.duration_minutes,void 0,{number:!0}]])]),t("div",ns,[s[46]||(s[46]=t("label",{class:"form-label"},"运动强度",-1)),p(t("select",{class:"form-select","onUpdate:modelValue":s[7]||(s[7]=e=>u.intensity_level=e)},[...s[45]||(s[45]=[t("option",{value:"低"},"低强度",-1),t("option",{value:"中等"},"中等强度",-1),t("option",{value:"高"},"高强度",-1)])],512),[[I,u.intensity_level]])])]),t("div",ds,[s[47]||(s[47]=t("label",{class:"form-label"},"备注",-1)),p(t("textarea",{class:"form-control",rows:"3","onUpdate:modelValue":s[8]||(s[8]=e=>u.notes=e),placeholder:"记录运动感受或其他信息..."},null,512),[[x,u.notes]])]),t("div",rs,[t("button",{type:"button",class:"btn btn-secondary",onClick:M}," 取消 "),t("button",{type:"submit",class:"btn btn-primary",disabled:w.value},[w.value?(c(),b("span",us)):V("",!0),s[48]||(s[48]=f(" 保存更改 ",-1))],8,cs)])],32)])])])],6)])}}}),fs=et(bs,[["__scopeId","data-v-73fe4b1b"]]);export{fs as default};
