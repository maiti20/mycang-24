import{d as Q,z as X,c as h,j as Y,r as b,k as Z,a as c,b as s,t as i,e as d,f as S,q as A,n as _,F as ss,g as es,m as ts,w as f,v as U,i as j,A as as,B as ls,s as W,o as v,_ as is}from"./index-CQKIO0cK.js";const ns={class:"profile-view"},os={class:"profile-header"},ds={class:"container"},rs={class:"row align-items-center py-5"},us={class:"col-md-3 text-center"},cs={class:"avatar-container"},vs=["src"],ms={key:1,class:"bi bi-person-fill"},bs={class:"col-md-9"},gs={class:"text-white mb-2"},ps={class:"text-white-50 mb-3"},fs={class:"d-flex gap-3 flex-wrap"},ys={class:"badge bg-light text-dark"},hs={key:0,class:"badge bg-light text-dark"},_s={class:"container py-4"},xs={key:0,class:"alert alert-success alert-dismissible fade show"},ws={key:1,class:"alert alert-danger alert-dismissible fade show"},ks={class:"row g-4"},Ms={class:"col-md-4"},Cs={class:"card stat-card h-100"},Ss={class:"card-body text-center"},Us={class:"mt-3"},Is={class:"col-md-4"},Vs={class:"card stat-card h-100"},As={class:"card-body text-center"},Bs={class:"mt-3"},Ds={class:"col-md-4"},$s={class:"card stat-card h-100"},zs={class:"card-body text-center"},Ns={class:"mt-3"},Fs={class:"col-12"},Ps={class:"card title-card"},Ts={class:"card-body"},Ls={class:"row align-items-center"},js={class:"col-md-4 text-center mb-3 mb-md-0"},Ws={class:"mt-3 mb-1"},qs={class:"text-muted small mb-0"},Es={class:"col-md-8"},Rs={class:"d-flex justify-content-between align-items-center mb-2"},Os={class:"fw-bold"},Gs={key:0,class:"text-muted"},Hs={key:1,class:"text-success"},Js={class:"progress mb-3",style:{height:"12px"}},Ks={class:"title-list"},Qs={class:"title-item-info"},Xs={class:"title-item-name"},Ys={class:"title-item-days"},Zs={class:"col-lg-8"},se={class:"card"},ee={class:"card-body"},te={class:"row g-3"},ae={class:"col-md-6"},le={class:"col-md-6"},ie={class:"col-md-4"},ne={class:"col-md-4"},oe={class:"col-md-4"},de={class:"col-md-6"},re={class:"input-group"},ue={class:"col-md-6"},ce={class:"input-group"},ve={class:"d-flex align-items-center"},me={class:"fw-bold"},be={class:"small text-muted"},ge={class:"mt-4"},pe=["disabled"],fe={key:0,class:"spinner-border spinner-border-sm me-2"},ye={class:"col-lg-4"},he={class:"card mb-4"},_e={class:"card-body"},xe={class:"d-grid gap-2"},we={class:"card"},ke={class:"card-body"},Me={class:"info-item"},Ce={class:"info-item"},Se=Q({__name:"ProfileView",setup(Ue){const B=X(),n=h(()=>B.user),l=Y({username:"",email:"",age:void 0,gender:"",height:void 0,weight:void 0,fitness_goal:""}),x=b(!1),y=b(""),r=b(""),g=b(0),z=b(0),N=b(0),F=b(null),D=b(!1),m=[{days:0,name:"健身小白",icon:"bi bi-egg",gradient:"linear-gradient(135deg, #a8a8a8, #6b6b6b)",description:"每个人都是从零开始"},{days:3,name:"初露锋芒",icon:"bi bi-star",gradient:"linear-gradient(135deg, #4ade80, #22c55e)",description:"坚持3天，好的开始"},{days:7,name:"周冠达人",icon:"bi bi-award",gradient:"linear-gradient(135deg, #60a5fa, #3b82f6)",description:"坚持一周，养成习惯"},{days:14,name:"毅力新星",icon:"bi bi-lightning-charge",gradient:"linear-gradient(135deg, #22d3ee, #06b6d4)",description:"两周坚持，毅力可嘉"},{days:30,name:"月度冠军",icon:"bi bi-trophy",gradient:"linear-gradient(135deg, #a855f7, #9333ea)",description:"一个月！了不起的成就"},{days:60,name:"钢铁意志",icon:"bi bi-shield-check",gradient:"linear-gradient(135deg, #f97316, #ea580c)",description:"60天，意志如钢"},{days:90,name:"健身达人",icon:"bi bi-fire",gradient:"linear-gradient(135deg, #ef4444, #dc2626)",description:"90天，真正的达人"},{days:180,name:"传奇人物",icon:"bi bi-gem",gradient:"linear-gradient(135deg, #fbbf24, #f59e0b)",description:"半年坚持，堪称传奇"},{days:365,name:"年度王者",icon:"bi bi-crown",gradient:"linear-gradient(135deg, #fcd34d, #f59e0b, #ef4444)",description:"一整年！你就是王者"}],u=h(()=>{for(let t=m.length-1;t>=0;t--)if(g.value>=m[t].days)return m[t];return m[0]}),w=h(()=>{const t=m.findIndex(e=>e.days===u.value.days);return t<m.length-1?m[t+1]:null}),q=h(()=>{if(!w.value)return 100;const t=u.value.days,e=w.value.days,o=(g.value-t)/(e-t)*100;return Math.min(Math.max(o,0),100)});function P(t,e){const o=e/(t/100)**2;return o<18.5?{value:Math.round(o*10)/10,status:"偏瘦",color:"info"}:o<24?{value:Math.round(o*10)/10,status:"正常",color:"success"}:o<28?{value:Math.round(o*10)/10,status:"偏胖",color:"warning"}:{value:Math.round(o*10)/10,status:"肥胖",color:"danger"}}const $=h(()=>{var t,e;return(t=n.value)!=null&&t.height&&((e=n.value)!=null&&e.weight)?P(n.value.height,n.value.weight):null}),k=h(()=>l.height&&l.weight?P(l.height,l.weight):null);function T(t){return t?new Date(t).toLocaleDateString("zh-CN"):"-"}function E(t){return t.toLocaleString("zh-CN")}function R(t){return t?t.startsWith("http")?t:as()+t:""}function O(){var t;(t=F.value)==null||t.click()}async function G(t){var M;const e=t.target,o=(M=e.files)==null?void 0:M[0];if(o){if(o.size>2*1024*1024){r.value="图片大小不能超过2MB";return}if(!o.type.startsWith("image/")){r.value="请选择图片文件";return}D.value=!0,r.value="";try{const p=new FileReader;p.onload=async I=>{var C;const V=(C=I.target)==null?void 0:C.result;try{const a=await ls.uploadAvatar(V);a.success?(y.value="头像上传成功",await B.fetchUser()):r.value=a.message||"上传失败"}catch(a){r.value=a.message||"上传失败"}finally{D.value=!1}},p.readAsDataURL(o)}catch(p){r.value=p.message||"读取文件失败",D.value=!1}e.value=""}}function L(){n.value&&Object.assign(l,{username:n.value.username,email:n.value.email,age:n.value.age,gender:n.value.gender||"",height:n.value.height,weight:n.value.weight,fitness_goal:n.value.fitness_goal||""})}function H(){L()}async function J(){try{const[t,e]=await Promise.allSettled([W.getStreakDays(),W.getWeekStats()]);t.status==="fulfilled"&&t.value.success&&(g.value=t.value.data.streak_days),e.status==="fulfilled"&&e.value.success&&(z.value=e.value.data.exercises||0,N.value=e.value.data.calories_burned||0)}catch(t){console.error(t)}}async function K(){x.value=!0,r.value="",y.value="";try{const t=await B.updateProfile({email:l.email,age:l.age,gender:l.gender,height:l.height,weight:l.weight,fitness_goal:l.fitness_goal});t.success?y.value="更新成功！":r.value=t.error||"更新失败"}catch(t){r.value=t.message||"更新失败"}finally{x.value=!1}}return Z(()=>{L(),J()}),(t,e)=>{var o,M,p,I,V,C;return v(),c("div",ns,[s("div",os,[s("div",ds,[s("div",rs,[s("div",us,[s("div",cs,[s("div",{class:"avatar",onClick:O},[(o=n.value)!=null&&o.avatar?(v(),c("img",{key:0,src:R(n.value.avatar),alt:"头像",class:"avatar-img"},null,8,vs)):(v(),c("i",ms)),e[12]||(e[12]=s("div",{class:"avatar-overlay"},[s("i",{class:"bi bi-camera"})],-1))]),s("input",{type:"file",ref_key:"avatarInput",ref:F,accept:"image/*",onChange:G,style:{display:"none"}},null,544),e[13]||(e[13]=s("small",{class:"text-white-50 d-block mt-2"},"点击更换头像",-1))])]),s("div",bs,[s("h1",gs,i(((M=n.value)==null?void 0:M.username)||"用户"),1),s("p",ps,[e[14]||(e[14]=s("i",{class:"bi bi-calendar3 me-2"},null,-1)),d("加入时间: "+i(T((p=n.value)==null?void 0:p.created_at)),1)]),s("div",fs,[s("span",ys,[e[15]||(e[15]=s("i",{class:"bi bi-bullseye me-1"},null,-1)),d(i(((I=n.value)==null?void 0:I.fitness_goal)||"未设置目标"),1)]),$.value?(v(),c("span",hs,[e[16]||(e[16]=s("i",{class:"bi bi-heart-pulse me-1"},null,-1)),d("BMI: "+i($.value.value)+" ("+i($.value.status)+") ",1)])):S("",!0),s("span",{class:"badge title-badge",style:A({background:u.value.gradient})},[s("i",{class:_([u.value.icon,"me-1"])},null,2),d(i(u.value.name),1)],4)])])])])]),s("div",_s,[y.value?(v(),c("div",xs,[e[17]||(e[17]=s("i",{class:"bi bi-check-circle me-2"},null,-1)),d(i(y.value)+" ",1),s("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=a=>y.value="")})])):S("",!0),r.value?(v(),c("div",ws,[e[18]||(e[18]=s("i",{class:"bi bi-exclamation-circle me-2"},null,-1)),d(i(r.value)+" ",1),s("button",{type:"button",class:"btn-close",onClick:e[1]||(e[1]=a=>r.value="")})])):S("",!0),s("div",ks,[s("div",Ms,[s("div",Cs,[s("div",Ss,[e[19]||(e[19]=s("div",{class:"stat-icon bg-primary bg-opacity-10 text-primary"},[s("i",{class:"bi bi-calendar-check"})],-1)),s("h3",Us,i(g.value),1),e[20]||(e[20]=s("p",{class:"text-muted mb-0"},"连续打卡天数",-1))])])]),s("div",Is,[s("div",Vs,[s("div",As,[e[21]||(e[21]=s("div",{class:"stat-icon bg-success bg-opacity-10 text-success"},[s("i",{class:"bi bi-lightning-charge"})],-1)),s("h3",Bs,i(z.value),1),e[22]||(e[22]=s("p",{class:"text-muted mb-0"},"本周运动次数",-1))])])]),s("div",Ds,[s("div",$s,[s("div",zs,[e[23]||(e[23]=s("div",{class:"stat-icon bg-danger bg-opacity-10 text-danger"},[s("i",{class:"bi bi-fire"})],-1)),s("h3",Ns,i(E(N.value)),1),e[24]||(e[24]=s("p",{class:"text-muted mb-0"},"本周消耗卡路里",-1))])])]),s("div",Fs,[s("div",Ps,[s("div",Ts,[s("div",Ls,[s("div",js,[s("div",{class:"title-icon-wrapper",style:A({background:u.value.gradient})},[s("i",{class:_([u.value.icon,"title-main-icon"])},null,2)],4),s("h4",Ws,i(u.value.name),1),s("p",qs,i(u.value.description),1)]),s("div",Es,[s("div",Rs,[s("span",Os,"当前连续打卡: "+i(g.value)+" 天",1),w.value?(v(),c("span",Gs,"下一称号: "+i(w.value.name)+" ("+i(w.value.days)+"天)",1)):(v(),c("span",Hs,[...e[25]||(e[25]=[s("i",{class:"bi bi-check-circle me-1"},null,-1),d("已达最高称号!",-1)])]))]),s("div",Js,[s("div",{class:"progress-bar",style:A({width:q.value+"%",background:u.value.gradient}),role:"progressbar"},null,4)]),s("div",Ks,[(v(),c(ss,null,es(m,a=>s("div",{key:a.days,class:_(["title-item",{active:g.value>=a.days,current:u.value.days===a.days}])},[s("div",{class:"title-item-icon",style:A(g.value>=a.days?{background:a.gradient}:{})},[s("i",{class:_(a.icon)},null,2)],4),s("div",Qs,[s("span",Xs,i(a.name),1),s("span",Ys,i(a.days)+"天",1)])],2)),64))])])])])])]),s("div",Zs,[s("div",se,[e[37]||(e[37]=s("div",{class:"card-header"},[s("h5",{class:"mb-0"},[s("i",{class:"bi bi-person-gear me-2"}),d("基本信息")])],-1)),s("div",ee,[s("form",{onSubmit:ts(K,["prevent"])},[s("div",te,[s("div",ae,[e[26]||(e[26]=s("label",{class:"form-label"},"用户名",-1)),f(s("input",{type:"text",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=a=>l.username=a),readonly:""},null,512),[[U,l.username]])]),s("div",le,[e[27]||(e[27]=s("label",{class:"form-label"},"邮箱",-1)),f(s("input",{type:"email",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=a=>l.email=a),required:""},null,512),[[U,l.email]])]),s("div",ie,[e[28]||(e[28]=s("label",{class:"form-label"},"年龄",-1)),f(s("input",{type:"number",class:"form-control","onUpdate:modelValue":e[4]||(e[4]=a=>l.age=a),min:"10",max:"120"},null,512),[[U,l.age,void 0,{number:!0}]])]),s("div",ne,[e[30]||(e[30]=s("label",{class:"form-label"},"性别",-1)),f(s("select",{class:"form-select","onUpdate:modelValue":e[5]||(e[5]=a=>l.gender=a)},[...e[29]||(e[29]=[s("option",{value:""},"请选择",-1),s("option",{value:"male"},"男",-1),s("option",{value:"female"},"女",-1)])],512),[[j,l.gender]])]),s("div",oe,[e[32]||(e[32]=s("label",{class:"form-label"},"健身目标",-1)),f(s("select",{class:"form-select","onUpdate:modelValue":e[6]||(e[6]=a=>l.fitness_goal=a)},[...e[31]||(e[31]=[s("option",{value:""},"请选择",-1),s("option",{value:"减脂塑形"},"减脂塑形",-1),s("option",{value:"增肌增重"},"增肌增重",-1),s("option",{value:"保持健康"},"保持健康",-1)])],512),[[j,l.fitness_goal]])]),s("div",de,[e[34]||(e[34]=s("label",{class:"form-label"},"身高",-1)),s("div",re,[f(s("input",{type:"number",class:"form-control","onUpdate:modelValue":e[7]||(e[7]=a=>l.height=a),step:"0.1"},null,512),[[U,l.height,void 0,{number:!0}]]),e[33]||(e[33]=s("span",{class:"input-group-text"},"cm",-1))])]),s("div",ue,[e[36]||(e[36]=s("label",{class:"form-label"},"体重",-1)),s("div",ce,[f(s("input",{type:"number",class:"form-control","onUpdate:modelValue":e[8]||(e[8]=a=>l.weight=a),step:"0.1"},null,512),[[U,l.weight,void 0,{number:!0}]]),e[35]||(e[35]=s("span",{class:"input-group-text"},"kg",-1))])])]),k.value?(v(),c("div",{key:0,class:_(["mt-4 p-3 rounded",`bg-${k.value.color} bg-opacity-10`])},[s("div",ve,[s("i",{class:_(["bi bi-heart-pulse fs-3 me-3",`text-${k.value.color}`])},null,2),s("div",null,[s("div",me,"BMI: "+i(k.value.value),1),s("div",be,i(k.value.status),1)])])],2)):S("",!0),s("div",ge,[s("button",{type:"submit",class:"btn btn-primary",disabled:x.value},[x.value?(v(),c("span",fe)):S("",!0),d(" "+i(x.value?"保存中...":"保存更改"),1)],8,pe),s("button",{type:"button",class:"btn btn-outline-secondary ms-2",onClick:H},"重置")])],32)])])]),s("div",ye,[s("div",he,[e[41]||(e[41]=s("div",{class:"card-header"},[s("h5",{class:"mb-0"},[s("i",{class:"bi bi-lightning me-2"}),d("快速操作")])],-1)),s("div",_e,[s("div",xe,[s("button",{class:"btn btn-outline-primary",onClick:e[9]||(e[9]=a=>t.$router.push("/diet/record"))},[...e[38]||(e[38]=[s("i",{class:"bi bi-plus-circle me-2"},null,-1),d("记录饮食",-1)])]),s("button",{class:"btn btn-outline-success",onClick:e[10]||(e[10]=a=>t.$router.push("/exercise/log"))},[...e[39]||(e[39]=[s("i",{class:"bi bi-activity me-2"},null,-1),d("记录运动",-1)])]),s("button",{class:"btn btn-outline-info",onClick:e[11]||(e[11]=a=>t.$router.push("/ai-plan"))},[...e[40]||(e[40]=[s("i",{class:"bi bi-robot me-2"},null,-1),d("AI健身方案",-1)])])])])]),s("div",we,[e[44]||(e[44]=s("div",{class:"card-header"},[s("h5",{class:"mb-0"},[s("i",{class:"bi bi-info-circle me-2"}),d("账户信息")])],-1)),s("div",ke,[s("div",Me,[e[42]||(e[42]=s("span",{class:"text-muted"},"注册时间",-1)),s("span",null,i(T((V=n.value)==null?void 0:V.created_at)),1)]),s("div",Ce,[e[43]||(e[43]=s("span",{class:"text-muted"},"用户ID",-1)),s("span",null,"#"+i((C=n.value)==null?void 0:C.id),1)])])])])])])])}}}),Ve=is(Se,[["__scopeId","data-v-c54d250f"]]);export{Ve as default};
