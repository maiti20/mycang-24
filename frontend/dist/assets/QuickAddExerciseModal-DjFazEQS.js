import{d as N,j as q,r as y,c as B,u as T,k as $,a as u,b as t,e as m,t as n,m as A,f as w,n as F,w as r,i as k,F as I,g as Q,v as a,h as j,p as E,o as c,_ as L}from"./index-CQKIO0cK.js";const z={class:"modal fade show d-block",tabindex:"-1",style:{"background-color":"rgba(0,0,0,0.5)"}},O={class:"modal-dialog modal-lg"},G={class:"modal-content"},H={class:"modal-header"},J={class:"modal-title"},K={class:"modal-body"},P={key:0,class:"alert alert-info mb-4"},R={class:"row"},W={class:"col-md-6"},X={class:"col-md-6"},Y={class:"mb-3"},Z=["disabled"],h=["value"],ee={class:"mb-3"},te={class:"input-group"},se={class:"mb-3"},oe={class:"mb-3"},le={class:"input-group"},ie={class:"row mb-3"},ne={class:"col-md-6"},re={class:"col-md-6"},ae={class:"mb-3"},de={class:"row mb-3"},ue={class:"col-md-6"},me={class:"input-group"},ce={class:"col-md-6"},ve={class:"input-group"},be={class:"modal-footer"},pe=["disabled"],fe={key:0,class:"spinner-border spinner-border-sm me-2"},xe=N({__name:"QuickAddExerciseModal",props:{exercise:{}},emits:["close","added"],setup(i,{emit:V}){var g;const f=i,x=V,s=q({exercise_id:((g=f.exercise)==null?void 0:g.id)||"",duration_minutes:30,intensity_level:"中等强度",exercise_date:new Date().toISOString().split("T")[0],exercise_time:new Date().toTimeString().slice(0,5),notes:"",avg_heart_rate:null,max_heart_rate:null}),d=y(!1),v=y([]),b=B(()=>{if(!s.exercise_id||!s.duration_minutes)return 0;const l=v.value.find(D=>D.id===s.exercise_id);if(!l)return 0;let e=l.calories_per_minute*s.duration_minutes;const o={低强度:.8,中等强度:1,高强度:1.3,极限强度:1.6}[s.intensity_level]||1;return Math.round(e*o)});T(()=>f.exercise,l=>{l&&(s.exercise_id=l.id)},{immediate:!0});const C=async()=>{try{const l=await E.getExercises({limit:100});l.success&&(v.value=l.data.exercises)}catch(l){console.error("加载运动列表失败:",l)}},M=()=>{},U=l=>{switch(l){case"初级":return"bg-success";case"中级":return"bg-warning";case"高级":return"bg-danger";default:return"bg-secondary"}},S=()=>{if(!s.exercise_id)throw new Error("请选择运动项目");if(!s.duration_minutes||s.duration_minutes<=0)throw new Error("请输入有效的运动时长");if(!s.intensity_level)throw new Error("请选择运动强度");if(!s.exercise_date)throw new Error("请选择运动日期");if(s.avg_heart_rate&&s.max_heart_rate&&s.avg_heart_rate>s.max_heart_rate)throw new Error("平均心率不能大于最大心率")},_=async()=>{try{d.value=!0,S();const l={exercise_id:Number(s.exercise_id),duration_minutes:s.duration_minutes,intensity_level:s.intensity_level,calories_burned:b.value,notes:s.notes||void 0},e=await E.createExerciseLog(l);if(e.success)x("added"),x("close");else throw new Error(e.message||"添加运动记录失败")}catch(l){console.error("提交运动记录失败:",l),alert(l instanceof Error?l.message:"添加运动记录失败，请重试")}finally{d.value=!1}};return $(()=>{C()}),(l,e)=>{var p;return c(),u("div",z,[t("div",O,[t("div",G,[t("div",H,[t("h5",J,[e[11]||(e[11]=t("i",{class:"bi bi-plus-circle me-2"},null,-1)),m(" "+n(((p=i.exercise)==null?void 0:p.name)||"添加运动记录"),1)]),t("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=o=>l.$emit("close"))})]),t("div",K,[t("form",{onSubmit:A(_,["prevent"])},[i.exercise?(c(),u("div",P,[t("div",R,[t("div",W,[e[12]||(e[12]=t("strong",null,"运动类型：",-1)),m(n(i.exercise.category),1),e[13]||(e[13]=t("br",null,null,-1)),e[14]||(e[14]=t("strong",null,"难度等级：",-1)),t("span",{class:F(["badge",U(i.exercise.difficulty_level)])},n(i.exercise.difficulty_level),3)]),t("div",X,[e[15]||(e[15]=t("strong",null,"消耗热量：",-1)),m(n(i.exercise.calories_per_minute)+" 千卡/分钟",1),e[16]||(e[16]=t("br",null,null,-1)),e[17]||(e[17]=t("strong",null,"目标肌群：",-1)),m(n(i.exercise.muscle_groups.join(", ")),1)])])])):w("",!0),t("div",Y,[e[19]||(e[19]=t("label",{class:"form-label"},"选择运动 *",-1)),r(t("select",{class:"form-select","onUpdate:modelValue":e[1]||(e[1]=o=>s.exercise_id=o),disabled:!!i.exercise,required:""},[e[18]||(e[18]=t("option",{value:""},"请选择运动",-1)),(c(!0),u(I,null,Q(v.value,o=>(c(),u("option",{key:o.id,value:o.id},n(o.name)+" ("+n(o.category)+" - "+n(o.calories_per_minute)+"千卡/分钟) ",9,h))),128))],8,Z),[[k,s.exercise_id]])]),t("div",ee,[e[21]||(e[21]=t("label",{class:"form-label"},"运动时长 (分钟) *",-1)),t("div",te,[r(t("input",{type:"number",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=o=>s.duration_minutes=o),min:"1",max:"999",required:"",onInput:M},null,544),[[a,s.duration_minutes,void 0,{number:!0}]]),e[20]||(e[20]=t("span",{class:"input-group-text"},"分钟",-1))]),e[22]||(e[22]=t("small",{class:"text-muted"},"建议运动时长：10-120分钟",-1))]),t("div",se,[e[24]||(e[24]=t("label",{class:"form-label"},"运动强度 *",-1)),r(t("select",{class:"form-select","onUpdate:modelValue":e[3]||(e[3]=o=>s.intensity_level=o),required:""},[...e[23]||(e[23]=[j('<option value="" data-v-ef939f90>请选择强度</option><option value="低强度" data-v-ef939f90>低强度</option><option value="中等强度" data-v-ef939f90>中等强度</option><option value="高强度" data-v-ef939f90>高强度</option><option value="极限强度" data-v-ef939f90>极限强度</option>',5)])],512),[[k,s.intensity_level]])]),t("div",oe,[e[26]||(e[26]=t("label",{class:"form-label"},"预计消耗热量",-1)),t("div",le,[r(t("input",{type:"number",class:"form-control","onUpdate:modelValue":e[4]||(e[4]=o=>b.value=o),readonly:""},null,512),[[a,b.value,void 0,{number:!0}]]),e[25]||(e[25]=t("span",{class:"input-group-text"},"千卡",-1))]),e[27]||(e[27]=t("small",{class:"text-muted"},"系统会根据运动类型、时长和强度自动计算",-1))]),t("div",ie,[t("div",ne,[e[28]||(e[28]=t("label",{class:"form-label"},"运动日期 *",-1)),r(t("input",{type:"date",class:"form-control","onUpdate:modelValue":e[5]||(e[5]=o=>s.exercise_date=o),required:""},null,512),[[a,s.exercise_date]])]),t("div",re,[e[29]||(e[29]=t("label",{class:"form-label"},"运动时间",-1)),r(t("input",{type:"time",class:"form-control","onUpdate:modelValue":e[6]||(e[6]=o=>s.exercise_time=o)},null,512),[[a,s.exercise_time]])])]),t("div",ae,[e[30]||(e[30]=t("label",{class:"form-label"},"备注",-1)),r(t("textarea",{class:"form-control","onUpdate:modelValue":e[7]||(e[7]=o=>s.notes=o),rows:"3",placeholder:"记录运动感受、身体状况等信息..."},null,512),[[a,s.notes]])]),t("div",de,[t("div",ue,[e[32]||(e[32]=t("label",{class:"form-label"},"平均心率",-1)),t("div",me,[r(t("input",{type:"number",class:"form-control","onUpdate:modelValue":e[8]||(e[8]=o=>s.avg_heart_rate=o),min:"40",max:"220"},null,512),[[a,s.avg_heart_rate,void 0,{number:!0}]]),e[31]||(e[31]=t("span",{class:"input-group-text"},"bpm",-1))])]),t("div",ce,[e[34]||(e[34]=t("label",{class:"form-label"},"最大心率",-1)),t("div",ve,[r(t("input",{type:"number",class:"form-control","onUpdate:modelValue":e[9]||(e[9]=o=>s.max_heart_rate=o),min:"40",max:"220"},null,512),[[a,s.max_heart_rate,void 0,{number:!0}]]),e[33]||(e[33]=t("span",{class:"input-group-text"},"bpm",-1))])])])],32)]),t("div",be,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[10]||(e[10]=o=>l.$emit("close"))}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:_,disabled:d.value},[d.value?(c(),u("span",fe)):w("",!0),m(" "+n(d.value?"保存中...":"保存记录"),1)],8,pe)])])])])}}}),ge=L(xe,[["__scopeId","data-v-ef939f90"]]);export{ge as Q};
